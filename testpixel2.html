<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pixel Transition_v2</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 200vh;
      overflow-x: hidden;
      font-family: Arial, sans-serif;
      color: white;
      background-color: #222222;
    }

    section {
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 3rem;
      text-align: center;
      position: relative;
      z-index: 2;
    }

    .projects {
      color: wheat;
    }

    canvas {
      position: fixed;
      inset: 0;
      z-index: 1;
      pointer-events: none;
    }
  </style>
</head>
<body>

  <canvas id="pixelCanvas"></canvas>

  <section class="info-section">
    <div class="content">
      <h1>About Me</h1>
      <p>Scroll down to watch the background pixelate and shift.</p>
    </div>
  </section>

  <section class="projects">
    <div class="content">
      <h1>Projects</h1>
      <p>Scroll up or down â€” the background animates both ways.</p>
    </div>
  </section>
  
  <script>
    gsap.registerPlugin(ScrollTrigger);

    const canvas = document.getElementById("pixelCanvas");
    const ctx = canvas.getContext("2d");

    let w, h, pixels = [];
    const pixelSize = 80;
    const eruptionHeight = 1.2;

    const fadeEndThreshold = 0.88;

    const colorStart = [34, 34, 34];
    const colorEnd = [245, 245, 245];

    function resize() {
      w = canvas.width = window.innerWidth;
      h = canvas.height = window.innerHeight;
      pixels = [];

      const cols = Math.ceil(w / pixelSize);
      const rows = Math.ceil(h / pixelSize);

      for (let i = 0; i < cols * rows; i++) {
        const x = (i % cols) * pixelSize;
        const y = Math.floor(i / cols) * pixelSize;
        pixels.push({
          x,
          y,
          offsetY: Math.random() * h * eruptionHeight,
          delay: Math.random() * 0.4
        });
      }
    }

    window.addEventListener("resize", resize);
    resize();

    function draw(progress) {
      ctx.clearRect(0, 0, w, h);
      const p = gsap.utils.clamp(0, 1, progress);

      const r = Math.floor(colorStart[0] + (colorEnd[0] - colorStart[0]) * p);
      const g = Math.floor(colorStart[1] + (colorEnd[1] - colorStart[1]) * p);
      const b = Math.floor(colorStart[2] + (colorEnd[2] - colorStart[2]) * p);
      const rgb = `rgb(${r}, ${g}, ${b})`;

      document.body.style.backgroundColor = rgb;

      ctx.globalAlpha = 0.35;

      pixels.forEach(px => {
        let local = Math.max(0, p - px.delay);
        let rise = px.offsetY * local;
        let y = px.y - rise;

        let fadeFactor = 1.0;
        if (p > fadeEndThreshold) {
          fadeFactor = 1 - (p - fadeEndThreshold) / (1 - fadeEndThreshold);
        }

        if (fadeFactor <= 0) return;

        ctx.fillStyle = p < 0.5 ? "#ffffff" : "#000000";
        ctx.globalAlpha = 0.35 * fadeFactor;

        if (y + pixelSize >= 0 && y <= h) {
          ctx.fillRect(px.x, y, pixelSize, pixelSize);
        }
      });

      ctx.globalAlpha = 1;
    }

    const st = ScrollTrigger.create({
      trigger: ".projects",
      start: "top bottom",
      end: "top top",
      scrub: 1.5,
      onUpdate: (self) => draw(self.progress),
      onLeave: () => draw(1),
      onLeaveBack: () => draw(0)
    });

    ScrollTrigger.addEventListener("refresh", () => draw(st.progress));
    draw(0);
  </script>
</body>
</html>
